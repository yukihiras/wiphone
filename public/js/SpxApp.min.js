function __preload(elm){$(elm).before('<img id="loading" style="position: absolute; z-index: 100000;" src="/public/img/loading.gif"/>')}function __preloadThis(elm){$(elm).html('<img id="loading"  src="/public/img/loading.gif"/>')}function __endload(){$("#loading").remove()}function makeParamsByOrder(_col){var pr_link=sapp.pr;pr_link.ord=_col;if(sapp.pr.ord==_col){if(sapp.pr.ordval=="asc")pr_link.ordval="desc";else pr_link.ordval="asc"}else pr_link.ordval="asc";return pr_link}function __alert(msg,elm,type){var _msg="";if(Array.isArray(msg))for(i=0;i<msg.length;i++)_msg+=msg[i]+"<br>";else _msg=msg;var dlg='<div class="alert alert-'+type+' alert-dismissible">\n'+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+_msg+"</div>";$(elm).append(dlg)}function __emptyAlert(elm){$(elm).html("")}function loadH(current_hk_tinh){$.get("/apps/list-h/"+current_hk_tinh).done(function(data){var opt='<option value=""> == Chọn huyện == </option>';$.each(data,function(index,item){opt+='<option value="'+item.id+'" ';if(item.id==current_hk_huyen)opt+=" selected ";opt+=">"+item.ten_huyen+"</option>"});$("#hk_huyen").html(opt)})}function formatItemTruongTHPT(item){if(item.loading){return item.text}var markup="<div class='clearfix'>"+item.id+". "+item.name+"</div>";return markup}function formatItemSelectionTruongTHPT(item){return item.name||item.id}$(document).ready(function(){if($("#appHomeQLDT").length>0){console.log("defined appHomeQLDT");var appHomeQLDT=new Object;appHomeQLDT.run=function(){appHomeQLDT.loadListLopToday()};appHomeQLDT.loadListLopToday=function(){__preloadThis("#list-lop-today");var _d="";$.get("/apps/lop/ajax-lich-hoc-get-by-day/"+_d).done(function(data,status){if(status=="success"){if(data.status==1){var _html_tb='<table class="table table-bordered">\n'+"                    <tr>\n"+'                        <th class="text-center">\n'+"                            Mã Lớp\n"+"                        </th>\n"+'                        <th class="text-center">\n'+"                            Ca học\n"+"                        </th>\n"+"                        <th>Phòng học</th>\n"+"                        <th>Môn học</th>\n"+"                        <th>Giảng viên</th>\n"+"<th></th>"+"                    </tr>";$.each(data.info,function(index,item){_html_tb+="<tr><td>"+item.ma_lop+"</td>";_html_tb+="<td>"+item.ca_hoc+"</td>";_html_tb+="<td>"+item.ten_phong+" ("+item.loai_phong+")</td>";_html_tb+="<td>"+item.ten_mh+"</td>";_html_tb+="<td>"+item.ho_ten+"</td>";_html_tb+="</tr>"});_html_tb+="</table>";$("#list-lop-today").html(_html_tb)}else{$("#list-lop-today").html("<span class='text-damger'>"+data.errors+"</span>")}}}).fail(function(err){console.log(err);alert("error")})};appHomeQLDT.run()}if(typeof appMenu!="undefined"){appMenu=new Object;appMenu.run=function(){this.elm_msg=$("#msg-box");$(".apMenu-chk-status").click(function(){if(confirm("Đồng ý thay đổi trạng thái?")!=true)return false;appMenu.changeStatus(this);return false})};appMenu.changeStatus=function(obj){var _url=$(obj).attr("href");$.post(_url,{confirm:1,_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){switch(data.status){case"refresh":location.reload();break;case"success":if(data.new_status==1)$(obj).html('<span class="alert-success" style="padding: 3px;"> ON </span>');else $(obj).html('<span class="alert-warning" style="padding: 3px;"> OFF </span>');__alert(data.success,appMenu.elm_msg,"success");break;case"error":__alert(data.errors,appMenu.elm_msg,"errors");break;case"warning":__alert(data.warnings,appMenu.elm_msg,"warnings");break}}}).fail(function(err){console.log(err)}).always(function(){console.log("finished")})};appMenu.run()}if(typeof appKhoaHoc!="undefined"){appKhoaHoc=new Object;appKhoaHoc.run=function(){this.elm_msg=$("#msg-box");$(".apKhoaHoc-chk-status").click(function(){if(confirm("Đồng ý thay đổi trạng thái?")!=true)return false;appKhoaHoc.changeStatus(this);return false});$(".apKhoaHoc-list-mh").click(function(){var _id=$(this).attr("data-id");if($("#list-mh-"+_id).html()==""){__emptyAlert($("#msg-box"));__preload($("#list-mh-"+_id));$.get("/apps/khoa-hoc/ajax-list-mh-"+_id).done(function(data){if(data.errors.length>0)__alert(data.errors,$("#msg-box"),"danger");if(data.warnings.length>0)__alert(data.warnings,$("#msg-box"),"warning");var _str="";$.each(data.list,function(index,item){if(_str==""){_str+='<table class="table table-bordered">';_str+='<tr><th style="line-height: 0.5">Mã MH</th><th style="line-height: 0.5">Tên MH</th><th style="line-height: 0.5">HK</th><th style="line-height: 0.5">TL</th></tr>'}_str+='<tr><td style="line-height:1">'+item.ma_mh+'</td><td style="line-height: 1">'+item.ten_mh+'</td><td style="line-height: 1">'+item.hoc_ky+'</td><td style="line-height: 1" title="Thời lượng">'+item.thoi_luong+"h </td></tr>"});if(_str!="")_str+="</table>";$("#list-mh-"+_id).html(_str)}).fail(function(){console.log("Error load list MH")}).always(function(){__endload()})}$("#list-mh-"+_id).toggle()})};appKhoaHoc.changeStatus=function(obj){var _url=$(obj).attr("href");$.post(_url,{confirm:1,_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){switch(data.status){case"refresh":location.reload();break;case"success":if(data.new_status==1)$(obj).html('<span class="alert-success" style="padding: 3px;"> ON </span>');else $(obj).html('<span class="alert-warning" style="padding: 3px;"> OFF </span>');__alert(data.success,appKhoaHoc.elm_msg,"success");break;case"error":__alert(data.errors,appKhoaHoc.elm_msg,"errors");break;case"warning":__alert(data.warnings,appKhoaHoc.elm_msg,"warnings");break}}}).fail(function(err){console.log(err)}).always(function(){console.log("finished")})};appKhoaHoc.run()}if(typeof appHocVien!="undefined"){appHocVien=new Object;appHocVien.trangThaiChamSoc=[];appHocVien.cs_mahv="";appHocVien.listLopRunning=[];appHocVien.xepLopHV="";appHocVien.xepLopID="";appHocVien.xepLopPrimary="";appHocVien.xepLopMH="";appHocVien.listCTDT=[];appHocVien.run=function(){console.log("app hoc vien");$.get("/apps/ajax-list-ctdt").done(function(data,status){if(status=="success"){appHocVien.listCTDT=data.list}}).fail(function(err){console.log(err)});$.get("/apps/lop/ajax-list-running",{_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){appHocVien.listLopRunning=data}}).fail(function(err){console.log(err)});if(typeof current_hk_tinh!=="undefined"){loadH(current_hk_tinh);$("#hk_tinh").on("select2:select",function(e){current_hk_tinh=$("#hk_tinh").val();loadH(current_hk_tinh)})}if($("#truong_thpt").length>0)$("#truong_thpt").select2({ajax:{url:"/apps/truong-thpt/search-ajax.html",dataType:"json",delay:250,data:function(params){console.log("search thpt...");return{search_name:params.term,page:params.page}},processResults:function(data,params){params.page=params.page||1;return{results:data.items,pagination:{more:params.page*data.item_per_page<data.total_count}}},cache:true},escapeMarkup:function(markup){return markup},minimumInputLength:1,templateResult:formatItemTruongTHPT,templateSelection:formatItemSelectionTruongTHPT});if($(".show-list-lop").length>0){$(".show-list-lop").click(function(){var _url="/apps/lop/ajax-list-by-hv-"+$(this).attr("data-id");var _strHtml='<table class="table table-bordered"><tr><th>Mã lớp</th><th>Ngày bắt đầu tham gia</th><th>Trạng thái</th></tr>';$.get(_url,{_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){$.each(data,function(index,item){_strHtml+="<tr>";_strHtml+="<td>"+item.ma_lop+"</td><td>"+item.ngay_bat_dau+"</td>"+"</td><td>"+item.trang_thai+"</td>";_strHtml+="<tr>"});$("#app-modal-dialog-title").html("Danh sách lớp đã tham gia");$("#app-modal-dialog-body").html(_strHtml);$("#app-modal-dialog").modal("show")}}).fail(function(err){console.log(err);alert("error")}).always(function(){console.log("finished")})})}$("#app-modal-dialog").on("hide.bs.modal",function(){$("#app-modal-dialog-body").html("");$("#app-modal-dialog-title").html("")});if($(".cham-soc-hv").length>0){$.get("/apps/hoc-vien/ajax-list-ttcs").done(function(data,status){if(status=="success"){appHocVien.trangThaiChamSoc=data}}).fail(function(err){console.log(err);alert("error")}).always(function(){});this.chamSocHocVien()}if($(".modal-show-more-cs").length>0){$(".modal-show-more-cs").click(function(){var _id_content=$(this).attr("data-content");$("#app-modal-dialog-title").html("Chi tiết nội dung...");$("#app-modal-dialog-body").html($("#"+_id_content).val());$("#app-modal-dialog").modal("show")})}if($("#hv_chk_all").length>0){var $table=$(".table");var $tdCheckbox=$table.find("td input:checkbox");var $tdCheckboxChecked=[];$("#hv_chk_all").on("click",function(){$tdCheckbox.prop("checked",this.checked)});$tdCheckbox.on("change",function(){$tdCheckboxChecked=$table.find("tbody input:checkbox:checked");$("#hv_chk_all").prop("checked",$tdCheckboxChecked.length==$tdCheckbox.length)});$("#btn-add-class-hv").on("click",function(){var tdCheckboxChecked=$table.find("tbody input:checkbox:checked");if(tdCheckboxChecked.length<1){alert("Chưa chọn Học viên");appHocVien.xepLopHV="";return false}var _strHtml='<div id="xl_msg" style="margin-bottom: 10px"></div>';_strHtml+="<div>Các học viên: ";$.each(tdCheckboxChecked,function(index,item){var _val=$(item).val();if(_val.length>3){appHocVien.xepLopHV+=_val+", ";_strHtml+=_val+", "}});_strHtml+="</div>";_strHtml+='<br><table><tr><td>Chọn Chương trình học: </td><td><select id="ctdt" style="margin-bottom: 10px; width:400px" class="form-control select2"><option value="">Chọn Chương trình học</option>';console.log(appHocVien.listCTDT);if(appHocVien.listCTDT.length>0)$.each(appHocVien.listCTDT,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ten_chuong_trinh+"</option>"});_strHtml+="</select></td></tr>";_strHtml+='<tr><td>Chọn Lớp: </td><td><select id="lop" style="margin-bottom: 10px; width:400px" class="form-control select2"><option value="">Chọn lớp</option>';if(appHocVien.listLopRunning.length>0)$.each(appHocVien.listLopRunning,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ma_lop+"</option>"});_strHtml+='</select><br><input type="checkbox" id="chk_primary"> Là lớp phụ</td></tr>';_strHtml+="</table>";_strHtml+='<br>Chọn môn học:<br><div id="box-list-mh" style="max-height: 300px; overflow: auto"></div>';_strHtml+='<br>Ghi chú: Cần kiểm tra kỹ thông tin trước khi lưu. Sau khi lưu sẽ không được sửa.<br><input type="button" id="btn-xep-lop" class="btn btn-primary pull-right" value="Xếp lớp"><div class="clearfix"></div> ';$("#app-modal-dialog-title").html("<b>Xếp Lớp cho Học viên</b>");$("#app-modal-dialog-body").html(_strHtml);$("#app-modal-dialog").modal("show");$(".select2").select2();$("#app-modal-dialog").on("change","#lop",function(){var _id_lop_slected=$(this).val();if(_id_lop_slected.length<1){appHocVien.xepLopID="";return}appHocVien.xepLopID=_id_lop_slected;appHocVien.xepLopMH="";$.get("/apps/mon-hoc/ajax-list-by-lop-"+_id_lop_slected,{_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){if(data.status==0){$("#box-list-mh").html('<ul style="list-style:none; color:red;"><li>'+data.errors.join(",")+"</li></ul>")}else{var _sub_str='<ul style="list-style:none">';var _pr=$("#chk_primary").is(":checked");$.each(data.listMH,function(index,item){var _chk=_pr==false?" checked ":"";_sub_str+='<li><input class="chk-select-mh-xl" type="checkbox"  value="'+item.id+"__"+item.thoi_luong+"__"+item.id_kh+'" '+_chk+'"> '+item.ma_mh+". "+item.ten_mh+"</li>"});_sub_str+="</ul>";$("#box-list-mh").html(_sub_str)}}}).fail(function(err){console.log(err);alert("error")})});$("#app-modal-dialog").on("click","#btn-xep-lop",function(){console.log("xep lop");appHocVien.xepLopPrimary=$("#chk_primary").is(":checked")?0:1;appHocVien.xepLopMH=[];var list_chk_mh=$("#box-list-mh").find("input:checkbox:checked");$.each(list_chk_mh,function(index,item){appHocVien.xepLopMH+=$(item).val()+","});var _ctdt=$("#ctdt").val();$.post("/apps/xep-lop",{_token:$("#_token").attr("content"),xepLopHV:appHocVien.xepLopHV,xepLopID:appHocVien.xepLopID,xepLopPrimary:appHocVien.xepLopPrimary,xepLopMH:appHocVien.xepLopMH,_ctdt:_ctdt}).done(function(data,status){if(status=="success"){console.log(data);appHocVien.xepLopID="";appHocVien.xepLopPrimary="";appHocVien.xepLopMH="";if(data.status==0){$("#xl_msg").html('<p style="color: red;">'+data.msg+"</p>")}else if(data.status==1){$("#app-modal-dialog-body").html('<p style="color: blue;">'+data.msg+"</p>");setTimeout(function(){location.reload(true)},1e3)}else{console.log("Error load data... post: /apps/xep-lop ");console.log(data)}}}).fail(function(err){console.log(err);$("#xl_msg").html('<p style="color: red;">'+err.responseJSON["message"]+"</p>")}).always(function(){})})})}if(typeof _id_lop_request!="undefined"){if(_id_lop_request!=""){getListMon(_id_lop_request,_id_mh_request);getListHocVien(_id_lop_request,_id_mh_request)}}$("#Lop").on("select2:select",function(e){var lop=$("#Lop").val();getListMon(lop,"")});function getListMon(id_lop,id_mh){$.get("/apps/mon-hoc/ajax-list-by-lop-"+id_lop).done(function(data){var _selected="";var opt='<option value=""> Chọn Môn học </option>';$.each(data.listMH,function(index,item){_selected=item.id==id_mh?"selected":"";opt+="<option "+_selected+' value="'+item.id+'" ';opt+=">"+item.ma_mh+". "+item.ten_mh+"</option>"});$("#mh").html(opt)})}$("#dn").prop("disabled",true);$("#mh").change(function(e){if($(this).val()>0)$("#dn").prop("disabled",false);else $("#dn").prop("disabled",true)});$("#lan").prop("disabled",true);$("#dn").change(function(e){console.log($(this).val());if(parseInt($(this).val())===2)$("#lan").prop("disabled",false);else $("#lan").prop("disabled",true)});if(typeof _id_mh_request!=="undefined"){if(_id_mh_request!=="")$("#dn").prop("disabled",false)}if(typeof _diem_nhap!=="undefined"){if(_diem_nhap==2)$("#lan").prop("disabled",false)}$("#btnLayDanhSach").click(function(){var lop=$("#Lop").val();var mon=$("#mh").val();var loai_diem=$("#Lop").val();var lan=$("#lan").val();if(lop==""||mon==""||loai_diem==""){alert("Vui lòng chọn đủ thông tin trước khi lấy danh sách nhập điểm");return}console.log(lop+"=>"+mon);getListHocVien(lop,mon)});function getListHocVien(lop,mon){$.get("/apps/hoc-vien/ajax-list-nhap-diem/"+lop+"?mon="+mon).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#dshv tbody").remove();$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#cs_msg span").remove();var i=0;var div='<tbody><tr><th style="width: 10px">STT</th><th>Mã Học Viên</th><th>Họ tên</th><th>Ngày sinh</th><th>Nhập điểm</th></tr>';$.each(data.list,function(index,item){i++;div+="<tr><td>"+i+"</td>";div+="<td>"+item.mahv+"</td>";div+="<td>"+item.ho_dem+" "+item.ten+"</td>";div+="<td>"+item.ngay_sinh+"</td>";div+='<td><input type="number" min="0" max="100" step="0.1" class="form-control" name="'+item.idlmhv+'_diem" placeholder="Nhập điểm"></td></tr>'});div+="</tbody>";$("#dshv").html(div).show()}}}).fail(function(err){console.log(err)}).always(function(){})}if($("#btn-print-hv").length>0){$("#btn-print-hv").click(function(){$("#frm-search-hv").append('<input type="hidden" name="event" value="print" />');$("#frm-search-hv").attr("target","_blank");$("#frm-search-hv").submit();$("#frm-search-hv").removeAttr("target");$("input[name=event]").remove()})}if($("#btn-export-hv").length>0){$("#btn-export-hv").click(function(){$("#frm-search-hv").append('<input type="hidden" name="event" value="export" />');$("#frm-search-hv").attr("target","_blank");$("#frm-search-hv").submit();$("#frm-search-hv").removeAttr("target");$("input[name=event]").remove()})}if($("#btn-toggle-option").length>0){$("#btn-toggle-option").click(function(){$(".option-show-col").toggle(300)});$("#saveOpton").click(function(){location.reload()});$(".chk_show_col").on("ifChecked",function(event){$.cookie($(this).val(),1,{expires:10})});$(".chk_show_col").on("ifUnchecked",function(event){$.cookie($(this).val(),1,{expires:-10})})}if($("#frm-search-hv").length>0)$(".search_input").on("keyup",function(e){if(e.keyCode==13){$("#frm-search-hv").submit()}});if($("#btn-toggle-option-search").length>0){$("#btn-toggle-option-search").click(function(){$(".option-show-search").toggle(300)})}if($(".set-trang-thai-hoc-tap").length>0){appHocVien.setTrangThaiHocTap()}if($(".alert-log-tt").length>0){$(".alert-log-tt").click(function(){$("#app-modal-dialog-title").html("Lịch sử thay đổi Trạng thái học tập: <b>"+$(this).attr("data-name")+"</b>");$("#app-modal-dialog-body").html($(this).attr("data-alert"));$("#app-modal-dialog").modal("show")})}};appHocVien.chamSocHocVien=function(){$(".cham-soc-hv").click(function(){console.log("cham soc hv");var _mahv=$(this).attr("data-id");var _hoten=$(this).attr("data-name");appHocVien.cs_mahv=_mahv;var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div></div><textarea id="cs_content" rows="5" placeholder="Nhập nội dung chăm sóc" class="col-sm-12 form-control" style="margin-bottom: 10px"></textarea>';_strHtml+='<br><br><select id="ttcs" class="form-control col-sm-6 col-xs-6"  style="margin-bottom: 10px"><option value="">Chọn trạng thái</option>';if(appHocVien.trangThaiChamSoc.length>0){$.each(appHocVien.trangThaiChamSoc,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ten_trang_thai+"</option>"})}_strHtml+="</select>";_strHtml+='<br><br><input type="button" class="btn btn-primary" id="cs_btn_submit" value=" Save " />';$("#app-modal-dialog-title").html("Chăm sóc học viên: <b>"+_mahv+". "+_hoten+"</b>");$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")});$("#app-modal-dialog").on("click","#cs_btn_submit",function(){var _cs_content=$("#cs_content").val();var _ttcs=$("#ttcs").val();$.post("/apps/hoc-vien/add-cs/"+appHocVien.cs_mahv,{_token:$("#_token").attr("content"),cs_content:_cs_content,ttcs:_ttcs}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công!</span>')}}}).fail(function(err){console.log(err)}).always(function(){})})};appHocVien.setTrangThaiHocTap=function(){$(".set-trang-thai-hoc-tap").click(function(){console.log("set-trang-thai-hoc-tap");var _mahv=$(this).attr("data-id");var _hoten=$(this).attr("data-name");appHocVien.tt_ht_mahv=_mahv;var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<select id="tt_ht" class="form-control col-sm-6 col-xs-6"  style="margin-bottom: 10px">'+'<option value="">Chọn trạng thái</option>';console.log(trang_thai_hoc_tap);if(typeof trang_thai_hoc_tap!="undefined"){$.each(trang_thai_hoc_tap,function(index,item){_strHtml+='<option value="'+index+'">'+item+"</option>"})}_strHtml+='</select><textarea id="ghichu_tt" rows="5" placeholder="Nhập nội dung ghi chú" class="col-sm-12 form-control" style="margin-bottom: 10px"></textarea>';_strHtml+='<br><br><input type="button" class="btn btn-primary" id="btn_submit_tt" value=" Save " />';$("#app-modal-dialog-title").html("Đổi trạng thái học tập: <b>"+_mahv+". "+_hoten+"</b>");$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")});$("#app-modal-dialog").on("click","#btn_submit_tt",function(){var _ghichu_tt=$("#ghichu_tt").val();var _tt_ht=$("#tt_ht").val();$.post("/apps/hoc-vien/trang-thai-hoc-tap/"+appHocVien.tt_ht_mahv,{_token:$("#_token").attr("content"),ghichu_tt:_ghichu_tt,tt_ht:_tt_ht}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công!</span>');setTimeout(function(){location.reload()},2e3)}}}).fail(function(err){console.log(err)}).always(function(){})})};appHocVien._ctdt=null;appHocVien._mahv=null;appHocVien._lop=null;appHocVien.showFullInfo=function(){appHocVien._ctdt=$("#ctdt_info").val();appHocVien._mahv=$("#ma_hv").text();if($("#ctdt_info").length>0)appHocVien.reloadNH();$("#page-full-info").on("change","#ctdt_info",function(){console.log("Change ctdt "+appHocVien._ctdt);appHocVien.reloadNH()})};appHocVien.reloadNH=function(){appHocVien._ctdt=$("#ctdt_info").val();console.log("reload NH "+appHocVien._ctdt);$.get("/apps/nganh-hoc/list-by-ctdt-"+appHocVien._ctdt).done(function(data,status){if(status=="success"){$("#info-nganh-hoc").text(data.objItem.ten_nganh)}}).fail(function(err){console.log(err);alert("error")})};appHocVien.run()}if(typeof appGiaoVien!="undefined"){appGiaoVien=new Object;appGiaoVien.run=function(){if($(".gv-view-list-mh").length>0)$(".gv-view-list-mh").click(function(){var _url="/apps/mon-hoc/ajax-list-by-gv-"+$(this).attr("data-id");var _gv_name=$(this).attr("data-name");$.get(_url).done(function(data,status){if(status=="success"){$("#app-modal-dialog-title").html("<b>Danh sách môn học của Giảng viên: "+_gv_name+"</b>");var _html='<table class="table table-bordered"><tr><th>Mã Môn học</th><th>Tên môn học</th></tr>';$.each(data.list,function(index,item){_html+="<tr><td>"+item.ma_mh+"</td><td>"+item.ten_mh+"</td></tr>"});_html+="</table>";$("#app-modal-dialog-body").html(_html);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")}}).fail(function(err){console.log(err);alert("error")}).always(function(){});return false});if($(".gv-xep-lop").length>0){$(".gv-xep-lop").click(function(){var _gv_name=$(this).attr("data-name");var _gv_id=$(this).attr("data-id");$("#app-modal-dialog-title").html("<b>Xếp lớp giảng dạy cho GV: "+_gv_name+"</b>");var _html='<div id="xl_msg"></div> <table><tr><td>Môn học:</td><td><select class="form-control select2" id="xlgv-slx-mh"><option value="">Chọn Môn học</option></select></td></tr>';_html+='<tr><td>Lớp:</td><td><select class="form-control select2"  id="xlgv-slx-lop"><option value="">Chọn Lớp </option></select></td></tr></table>';_html+='<br>Ghi chú: Cần kiểm tra kỹ thông tin trước khi lưu (chức năng này đang phát triển, cần điều chỉnh thêm).<br><input type="button" id="btn-xep-lop-gv" class="btn btn-primary pull-right" value="Xếp lớp"><div class="clearfix"></div> ';$("#app-modal-dialog-body").html(_html);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show");$(".select2").select2();var _url="/apps/mon-hoc/ajax-list-by-gv-"+_gv_id;$.get(_url).done(function(data,status){if(status=="success"){$.each(data.list,function(index,item){$("#xlgv-slx-mh").append('<option value="'+item.id+'">'+item.ten_mh+"</option>")})}}).fail(function(err){console.log(err);alert("error")}).always(function(){});$.get("/apps/lop/ajax-list-running",{_token:$("#_token").attr("content")}).done(function(data,status){if(status=="success"){$.each(data,function(index,item){$("#xlgv-slx-lop").append('<option value="'+item.id+'">'+item.ma_lop+"</option>")})}}).fail(function(err){console.log(err);alert("error")});$("#app-modal-dialog").on("click","#btn-xep-lop-gv",function(){console.log("xep lop gv");var _mh=$("#xlgv-slx-mh").val();var _lp=$("#xlgv-slx-lop").val();$.post("/apps/xep-lop-gv",{_token:$("#_token").attr("content"),_gv_id:_gv_id,_mh:_mh,_lp:_lp}).done(function(data,status){if(status=="success"){console.log(data);if(data.status==0){$("#xl_msg").html('<p style="color: red;">'+data.msg+"</p>")}else{$("#xl_msg").html('<p style="color: blue;">'+data.msg+"</p>")}}}).fail(function(err){console.log(err);$("#xl_msg").html('<p style="color: red;">'+err.responseJSON["message"]+"</p>")}).always(function(){})});return false})}};appGiaoVien.run()}if(typeof appLop!="undefined"){appLop=new Object;appLop.listKH=[];appLop.listUser=[];appLop.listKHLop=[];appLop.currentIdEdit=0;appLop.status_cs=0;appLop.run=function(){if($(".lop-add-kh").length>0)$.get("/apps/khoa-hoc/ajax-list-kh").done(function(data,status){if(status=="success"){if(data.status==1){appLop.listKH=data.list}}}).fail(function(err){console.log(err)});if($(".cs-lop").length>0)$.get("/apps/lop/ajax-list-user-cb").done(function(data,status){if(status=="success"){if(data.status==1){appLop.listUser=data.list}}}).fail(function(err){console.log(err)});if($(".cs-lop").length>0)$(".cs-lop").click(function(){appLop.currentIdEdit=$(this).attr("data-id");$("#app-modal-dialog-title").html("<b>Thêm lịch chăm sóc lớp</b>");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<div class="form-group"><label>User Chăm sóc lớp</label><select class="form-control select2" id="user_cs" name="user_cs[]" multiple="multiple" data-placeholder="Chọn người chăm sóc lớp" style="width: 100%;">';if(appLop.listUser.length>0){$.each(appLop.listUser,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.username+"</option>"})}_strHtml+="</select></div>";_strHtml+='<div class="form-group"><lable>Ngày bắt đầu:</lable><input type="text" placeholder="dd/mm/yyyy" class="form-control" id="start_date"></div>';_strHtml+='<div class="form-group"><lable>Ngày kết thúc:</lable><input type="text" placeholder="dd/mm/yyyy" class="form-control" id="end_date"></div>';_strHtml+='<br><br><input type="button" class="btn btn-primary" id="lich_cs_btn_submit" value=" Save " />';$("#app-modal-dialog-body").html(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show");$(".select2").select2()});$("#app-modal-dialog").on("click","#lich_cs_btn_submit",function(){var _id_user_cs=$("#user_cs").val();var _start_date=$("#start_date").val();var _end_date=$("#end_date").val();if(_id_user_cs==""||_start_date==""||_end_date==""){alert("Vui lòng nhập đầy đủ thông tin");return}$.post("/apps/lop/ajax-add-lich-cs/"+appLop.currentIdEdit,{_token:$("#_token").attr("content"),user_cs:_id_user_cs,start_date:_start_date,end_date:_end_date}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{console.log("save lich cham soc OK");$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công! Đang tải lại trang...</span>');setTimeout(function(){location.reload(true)},1e3)}}}).fail(function(err){console.log(err)}).always(function(){})});$("#app-modal-dialog").on("keypress","#nam_thu",function(evt){evt.preventDefault()});if($(".change_status").length>0)$(".change_status").click(function(){appLop.currentIdEdit=$(this).attr("data-id");appLop.status_cs=$(this).attr("data-status");console.log(appLop.status_cs+"=>"+appLop.currentIdEdit);$("#app-modal-dialog-title").html("<b>Ghi chú thay đổi trạng thái</b>");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<div class="form-group"><lable>Ghi chú</lable><textarea type="text" rows="5" class="form-control" id="ghi_chu"></textarea></div>';_strHtml+='<br><br><input type="button" class="btn btn-primary" id="ghichu_submit" value="Xong" />';$("#app-modal-dialog-body").html(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show");$(".select2").select2()});$("#app-modal-dialog").on("click","#ghichu_submit",function(){var _ghi_chu=$("#ghi_chu").val();console.log(_ghi_chu);if(_ghi_chu==""){alert("Vui lòng nhập ghi chú trước khi thay đổi trạng thái");return}$.post("/apps/lop/change-status-cham-soc/"+appLop.currentIdEdit,{_token:$("#_token").attr("content"),status:appLop.status_cs,ghi_chu:_ghi_chu}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{console.log("save kh OK");$("#app-modal-dialog-body").html('<span style="color:blue">Đã thay đổi trạng thái thành công! Đang tải lại trang...</span>');setTimeout(function(){location.reload(true)},1e3)}}}).fail(function(err){console.log(err)}).always(function(){})});if($(".lop-add-kh").length>0)$(".lop-add-kh").click(function(){appLop.currentIdEdit=$(this).attr("data-id");$("#app-modal-dialog-title").html("<b>Thêm Khóa học cho Lớp</b>");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<select id="kh_to_lop" class="form-control select2" style="margin-bottom: 10px; width:300px"><option value="">Chọn Khóa học</option>';if(appLop.listKH.length>0){$.each(appLop.listKH,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ten_khoa_hoc+"(Hệ: "+item.ten_he_dao_tao+")"+"</option>"})}_strHtml+='</select> Năm thứ: <input type="number" min="1" max="3" step="1"    id="nam_thu" value="1">';_strHtml+='<br><br><p>Chú ý: Chức năng này chỉ thêm, không xóa, sửa. Nếu cần thiết vui lòng liên hệ Quản trị.</p><input type="button" class="btn btn-primary" id="cs_btn_submit" value=" Save " />';$("#app-modal-dialog-body").html(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show");$(".select2").select2()});$("#app-modal-dialog").on("click","#cs_btn_submit",function(){var _id_kh_add=$("#kh_to_lop").val();var _nam_thu=$("#nam_thu").val();$.post("/apps/lop/ajax-update-kh-to-lop-"+appLop.currentIdEdit,{_token:$("#_token").attr("content"),kh_to_lop:_id_kh_add,nam_thu:_nam_thu}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{console.log("save kh OK");$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công! Đang tải lại trang...</span>');setTimeout(function(){location.reload(true)},1e3)}}}).fail(function(err){console.log(err)}).always(function(){})});$("#app-modal-dialog").on("keypress","#nam_thu",function(evt){evt.preventDefault()});if($(".frm_lich_hoc").length>0)appLop.lichHoc();if($("#diem_danh_lop").length>0)$("#diem_danh_lop").change(function(){$("form[class=filter-box]").submit()});if($("#diem_danh_mh").length>0)$("#diem_danh_mh").change(function(){$("form[class=filter-box]").submit()});if($("#diem_danh_d").length>0)$("#diem_danh_d").change(function(){$("form[class=filter-box]").submit()})};appLop.lichHoc_lop=0;appLop.lichHoc_mh=0;appLop.lichHoc=function(){$("#lop").on("select2:select",function(e){var lop=$("#lop").val();if(lop.length==0)return;__preloadThis("#box-table-full-info");$.get("/apps/lop/ajax-lich-hoc-full-info-"+lop).done(function(data){if(data.status==1){var _html_tb="";$.each(data.info,function(index,item){_html_tb+='<hr><h4 class="text-info"><i class="fa fa-book"></i> Chương trình Đào tạo: <b>'+item.ten_ctdt+"</b></h4>";$.each(item.detail,function(index,lop){_html_tb+='<h4 class="text-info"><i class="fa fa-users"></i> Lớp: <b>'+lop.ma_lop+"</b></h4>";_html_tb+='<h4 class="text-info"><i class="fa fa-mortar-board"></i> Khóa học: <b>'+lop.ten_khoa_hoc+"</b></h4>";_html_tb+='<div class="table-responsive"><table class="table table-striped table-bordered">\n'+"<tr>\n"+"<th>#ID</th>\n"+"<th>Mã MH</th>\n"+"<th>Môn học</th>\n"+"<th>Trạng thái</th>\n"+"<th>Số giờ quy định</th>\n"+"<th>Thêm giờ</th>\n"+"<th>Bù giờ điểm danh</th>\n"+"<th>Số giờ đã học</th>\n"+"<th>Số giờ còn lại</th>\n"+"<th>Ca học</th>\n"+"<th>Ngày học</th>\n"+"<th>Giảng viên</th>\n"+"<th>Phòng học</th>\n"+"</tr>";$.each(lop.mh,function(id,monhoc){_html_tb+="<tr><td>"+id+"</td>";_html_tb+="<td>"+monhoc.ma_mh+"</td>";_html_tb+="<td>"+monhoc.ten_mh+"</td>";var _tt="";if(monhoc.trang_thai==0)_tt="Chưa học";else if(monhoc.trang_thai==1)_tt='<span class="text-info">Đang học</span>';else if(monhoc.trang_thai==-1)_tt='<span class="text-damger">Kết thúc</span>';_html_tb+="<td>"+_tt+"</td>";_html_tb+='<td class="text-center"><b>'+monhoc.tong_so_gio_hoc+"</b></td>";_html_tb+='<td class="text-center"><b>'+monhoc.so_gio_them+"</b></td>";_html_tb+='<td class="text-center"><b>'+monhoc.so_gio_bu+"</b></td>";_html_tb+='<td class="text-center"><b>'+monhoc.so_gio_da_hoc+"</b></td>";_html_tb+='<td class="text-center"><b>'+monhoc.so_gio_con_lai+"</b></td>";_html_tb+="<td>"+monhoc.ca_hoc+"</td>";_html_tb+="<td>"+monhoc.ngay_hoc+"</td>";_html_tb+="<td>"+monhoc.hoten_gv+"</td>";_html_tb+="<td>"+monhoc.phong_hoc+"</td>";_html_tb+="</tr>"});_html_tb+="</table></div>"})});$("#box-table-full-info").html(_html_tb)}else{$("#box-table-full-info").html("<hr>"+data.errors)}}).fail(function(err){console.log(err)});$.get("/apps/mon-hoc/ajax-list-by-lop-"+lop,{_:$.now()}).done(function(data){var opt='<option value=""> Chọn Môn học </option>';$.each(data.listMH,function(index,itemMH){opt+='<option value="'+itemMH.id+'" ';opt+=">"+itemMH.ma_mh+". "+itemMH.ten_mh+"</option>"});$("#mh").html(opt)})});$("#mh").on("select2:select",function(e){appLop.lichHoc_lop=$("#lop").val();appLop.lichHoc_mh=$("#mh").val();$.get("/apps/lop/ajax-lich-hoc-"+appLop.lichHoc_lop+"-"+appLop.lichHoc_mh).done(function(data){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="\n"+item});alert(_msg_err);return}var _info=data.info;$("#tx_ngay_bat_dau").val(_info.ngay_bat_dau);$("#tx_ngay_hoc").val(_info.ngay_hoc);$("#ca_hoc").val(_info.ca_hoc);$("#phong_hoc").val(_info.id_phong_hoc);$("#tx_so_gio_ca").val(_info.so_gio_1ca);$("#tx_tong_so_gio_mh").val(_info.tong_so_gio_hoc);$("#tx_so_gio_da_hoc").val(_info.so_gio_da_hoc);$("#tx_so_gio_chua_hoc").val(parseInt(_info.tong_so_gio_hoc)+parseInt(_info.so_gio_them)-parseInt(_info.so_gio_da_hoc));$("#tx_so_gio_them").val(_info.so_gio_them);$("#tx_so_gio_bu").val(_info.so_gio_bu)})});$("#btn-save-lh").click(function(){var tx_ngay_hoc=$("#tx_ngay_hoc").val();var phong_hoc=$("#phong_hoc").val();var ca_hoc=$("#ca_hoc").val();var tx_so_gio_da_hoc=$("#tx_so_gio_da_hoc").val();var tx_so_gio_chua_hoc=$("#tx_so_gio_chua_hoc").val();var tx_so_gio_them=$("#tx_so_gio_them").val();var tx_so_gio_bu=$("#tx_so_gio_bu").val();var tx_ngay_bat_dau=$("#tx_ngay_bat_dau").val();console.log(tx_ngay_hoc);$.post("/apps/lop/ajax-lich-hoc-"+appLop.lichHoc_lop+"-"+appLop.lichHoc_mh,{_token:$("#_token").attr("content"),tx_ngay_hoc:tx_ngay_hoc,phong_hoc:phong_hoc,ca_hoc:ca_hoc,tx_so_gio_da_hoc:tx_so_gio_da_hoc,tx_so_gio_chua_hoc:tx_so_gio_chua_hoc,tx_ngay_bat_dau:tx_ngay_bat_dau,tx_so_gio_them:tx_so_gio_them,tx_so_gio_bu:tx_so_gio_bu}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="\n"+item});alert(_msg_err);return}else{alert("Cập nhật thành công!");window.location.reload()}}}).fail(function(err){console.log(err)}).always(function(){})})};appLop.run()}if(typeof appChuongTrinhDaoTao!="undefined"){appChuongTrinhDaoTao=new Object;appChuongTrinhDaoTao.listKHDH=[];appChuongTrinhDaoTao._id_ct=0;appChuongTrinhDaoTao.run=function(){$.get("/apps/khoa-hoc/ajax-list-kh-dai-han").done(function(data,status){if(status=="success"){if(data.status==1){appChuongTrinhDaoTao.listKHDH=data.list}}}).fail(function(err){console.log(err)});if($(".ctdt-list-kh").length>0)appChuongTrinhDaoTao.showListKH();if($(".ctdt-list-mh").length>0)appChuongTrinhDaoTao.showListMH();if($(".ctdt-add-kh").length>0)appChuongTrinhDaoTao.addKH()};appChuongTrinhDaoTao.addKH=function(){$(".ctdt-add-kh").click(function(){appChuongTrinhDaoTao._id_ct=$(this).attr("data-id");var _name=$(this).attr("data-name");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<select id="kh_to_ct" multiple class="form-control select2"  style="margin-bottom: 10px; width: 400px;"><option value="">Chọn Module</option>';if(appChuongTrinhDaoTao.listKHDH.length>0){$.each(appChuongTrinhDaoTao.listKHDH,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ten_khoa_hoc+"</option>"})}console.log(_strHtml);_strHtml+="</select>";_strHtml+='<br><br><input type="button" class="btn btn-primary" id="cs_btn_submit" value=" Save " />';$("#app-modal-dialog-title").html("Thêm Module cho Chương trình Đào tạo: <b>"+_name+"</b>");$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show");$(".select2").select2()});$("#app-modal-dialog").on("click","#cs_btn_submit",function(){var kh_to_ct=$("#kh_to_ct").val();$.post("/apps/chuong-trinh-dao-tao/add-kh/"+appChuongTrinhDaoTao._id_ct,{_token:$("#_token").attr("content"),kh_to_ct:kh_to_ct}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-body").html("");$("#cs_msg").html('<span style="color:blue">Đã lưu thành công!</span>')}}}).fail(function(err){console.log(err)}).always(function(){})})};appChuongTrinhDaoTao.showListKH=function(){$(".ctdt-list-kh").click(function(){var _url="/apps/khoa-hoc/ajax-list-kh-ctdt-"+$(this).attr("data-id");$.get(_url).done(function(data,status){if(status=="success"){$("#app-modal-dialog-title").html("Danh sách Module (Khóa học)");if(data.status!=1){$("#app-modal-dialog-body").html(data.errors.join("<br>"));$("#app-modal-dialog").modal("show");return}var _html='<table class="table table-bordered"><tr><th>Mã Khóa học</th><th>Tên khóa</th></tr>';$.each(data.list,function(index,item){_html+="<tr><td>"+item.ma_khoa_hoc+"</td><td>"+item.ten_khoa_hoc+"</td></tr>"});_html+="</table>";$("#app-modal-dialog-body").html(_html);$("#app-modal-dialog").modal("show")}}).fail(function(err){console.log(err);alert("error")}).always(function(){});return false})};appChuongTrinhDaoTao.showListMH=function(){$(".ctdt-list-mh").click(function(){var _url="/apps/khoa-hoc/ajax-list-mh-"+$(this).attr("data-id");var _name=$(this).attr("data-name");$.get(_url).done(function(data,status){if(status=="success"){$("#app-modal-dialog-title").html("Danh sách Môn học thuộc: "+_name);if(data.status!="success"){$("#app-modal-dialog-body").html(data.errors.join("<br>"));$("#app-modal-dialog").modal("show");return}var _html='<table class="table table-bordered"><tr><th>ID</th><th>Mã Môn học</th><th>Tên Môn học</th><th>Học kỳ</th></tr>';if(data.list.length>0)$.each(data.list,function(index,item){_html+="<tr><td>"+item.id_mh+"</td><td>"+item.ma_mh+"</td><td>"+item.ten_mh+"</td><td>"+item.hoc_ky+"</td></tr>"});else _html+="Chưa thiết lập Môn học";_html+="</table>";console.log(_html);$("#app-modal-dialog-body").html(_html);$("#app-modal-dialog").modal("show")}}).fail(function(err){console.log(err);alert("error")}).always(function(){});return false})};appChuongTrinhDaoTao.run()}if(typeof appLichChamSoc!="undefined"){appLichChamSoc=new Object;appLichChamSoc.run=function(){};appLichChamSoc.addCS=function(){};appLichChamSoc.run()}if(typeof appQuanLyDaoTao!="undefined"){appQuanLyDaoTao=new Object;appQuanLyDaoTao.danhgia=[];appQuanLyDaoTao.run=function(){$("#lophoc").change(function(){console.log("test");$.get("/apps/ajax-get-list-mon-hoc/"+$(this).val()).done(function(data,status){if(status=="success"){$("#monhoc").html('<option value="">-- Chọn môn học --</option>');$.each(data.list,function(index,item){$("#monhoc").append('<option value="'+item.id+'">'+item.ten_mh+"</option>")})}}).fail(function(err){console.log(err);alert("error")})});$("#monhoc").change(function(){console.log("test");$.get("/apps/ajax-get-list-giang-vien/"+$(this).val()+"/"+$("#lophoc").val()).done(function(data,status){if(status=="success"){$("#giangvien").html('<option value="">-- Chọn giảng viên --</option>');$.each(data.list,function(index,item){$("#giangvien").append('<option value="'+item.id+'">'+item.ho_ten+"</option>")})}}).fail(function(err){console.log(err);alert("error")})});$(".btn-stop-time").click(function(){var res=confirm("Khi chọn dừng tất cả sinh viên của lớp này sẽ không thể đánh giá giảng viên này nữa!Bạn có muốn tiếp tục?");if(res){$.post("/apps/ajax-end-time",{_token:_token,id_giao_vien:$(this).attr("data-id-gv"),id_lop:$(this).attr("data-id-lop"),id_mon_hoc:$(this).attr("data-id-mon")}).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#cs_msg").html('<span style="color:blue">Đã lưu thành công!</span>');setTimeout(function(){location.reload()},2e3)}}}).fail(function(err){console.log(err)}).always(function(){})}});$(".btn-view-dg").click(function(){var _id_gv=$(this).attr("data-id-gv");var _id_mh=$(this).attr("data-id-mon");var _id_lop=$(this).attr("data-id-lop");var _mahv=$(this).attr("data-mahv");$.get("/apps/ajax-view-danh-gia?id_gv="+_id_gv+"&id_mh="+_id_mh+"&id_lop="+_id_lop+"&mahv="+_mahv).done(function(data,status){if(status=="success"){$("#app-modal-dialog .modal-dialog").addClass("modal-lg");$("#app-modal-dialog-title").html("Chi tiết đánh giá giảng viên: "+data.giaovien+"<br/>ID tài khoản đánh giá: "+data.id_tk);if(data.status!=1){console.log(data.errors);$("#app-modal-dialog-body").html(data.errors.join("<br>"));$("#app-modal-dialog").modal("show");var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>");return}else{appQuanLyDaoTao.danhgia=data.list;if(Object.keys(data.list).length>0){var _html='<table class="table table-bordered"><tr><th>Câu hỏi</th><th>Trả lời</th><th>Ghi chú</th></tr>';var ghichu="";$.each(data.list,function(index,item){ghichu=typeof item.ghichu!=="undefined"?item.ghichu:"";_html+="<tr><td>"+index+". "+item.cauhoi+"</td><td>"+item.dapan+"</td><td>Ghi chú:"+ghichu+"</td></tr>"});_html+="</table>";console.log(_html)}else{$("#cs_msg").html('<span style="color:red">Không có dữ liệu!</span>')}$("#app-modal-dialog-body").html(_html);$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err)}).always(function(){})})};appQuanLyDaoTao.run()}if(typeof appHocPhi!="undefined"){appHocPhi=new Object;appHocPhi.khoanthu=[];appHocPhi.chitiet=[];appHocPhi.id_phieu=0;appHocPhi.run=function(){$.get("/apps/ajax-list-khoan-thu").done(function(data,status){if(status=="success"){appHocPhi.khoanthu=data.list;console.log(appHocPhi.khoanthu.length)}}).fail(function(err){console.log(err);alert("error")});$(".btnChiTiet").click(function(){appHocPhi.id_phieu=$(this).attr("data-id");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<select id="khoan_thu" class="form-control col-sm-6 col-xs-6"  style="margin-bottom: 10px"><option value="">Chọn khoản thu</option>';if(appHocPhi.khoanthu.length>0){console.log("test");$.each(appHocPhi.khoanthu,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.noi_dung+"</option>"})}_strHtml+="</select>";_strHtml+='<br/><br/><input type="text" placeholder="Nhập số tiền" name="so_tien" id="so_tien" class="form-control"/>';_strHtml+='<br/><textarea name="ghi_chu" placeholder="Nhập ghi chú" id="ghi_chu" class="form-control"></textarea>';_strHtml+='<br><br><input type="button" class="btn btn-primary" id="btnAddChiTiet" value=" Save " />';$("#app-modal-dialog-title").html("Thêm học phí chi tiết");$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")});$("#app-modal-dialog").on("click","#btnAddChiTiet",function(){var _id_khoan=$("#khoan_thu").val();var _so_tien=$("#so_tien").val();var _ghi_chu=$("#ghi_chu").val();if(_id_khoan==""||_so_tien==""){alert("Vui lòng điền đầy đủ thông tin");return}$.post("/apps/ajax-post-chi-tiet-hoc-phi",{_token:$("#_token").attr("content"),id_khoan_thu:_id_khoan,so_tien:_so_tien,id_phieu:appHocPhi.id_phieu,ghi_chu:_ghi_chu}).done(function(data,status){if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công!</span>')}}}).fail(function(err){console.log(err)}).always(function(){})});$(".btnDanhSach").click(function(){$(".modal-dialog").addClass("modal-lg");appHocPhi.id_phieu=$(this).attr("data-id");$.get("/apps/ajax-list-hoc-phi-chi-tiet/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>");return}else{appHocPhi.chitiet=data.list;var _strHtml='<div class="box">';if(appHocPhi.chitiet.length>0){_strHtml+='<table class="table table-bordered"><tr><th style="width: 10px">ID Khoản</th><th>Nội dung khoản</th><th>Số tiền</th><th>Ghi chú</th></tr>';console.log(appHocPhi.chitiet);$("#cs_msg span").remove();$.each(appHocPhi.chitiet,function(index,item){_strHtml+="<tr><td>"+item.id_khoan_thu+"</td><td>"+item.noi_dung+"</td><td>"+item.so_tien+"</td><td>"+item.ghi_chu+"</td></tr>"});_strHtml+="</table>"}$("#app-modal-dialog-title").html("Danh sách chi tiết học phí của phiếu: "+appHocPhi.id_phieu);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err);alert("error")})})};appHocPhi.run()}if(typeof appDoanhNghiep!="undefined"){appDoanhNghiep=new Object;appDoanhNghiep.hocVien=[];appDoanhNghiep.chuyenNganh=[];appDoanhNghiep.id_doanh_nghiep="";appDoanhNghiep.name="";appDoanhNghiep.run=function(){$.get("/apps/ajax-list-nganh-hoc").done(function(data,status){if(status=="success"){appDoanhNghiep.chuyenNganh=data.list}}).fail(function(err){console.log(err);alert("error")});$(".addHocVien").click(function(){appDoanhNghiep.id_doanh_nghiep=$(this).attr("data-id");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<select id="mahv" class="form-control col-sm-6 col-xs-6 search_hv"  style="margin-bottom: 10px;width: 100%;"></select>';_strHtml+='<br/><br/><input type="text" placeholder="Nhập họ tên" name="ho_ten" id="ho_ten" class="form-control"/>';_strHtml+='<select id="nganh" class="form-control col-sm-6 col-xs-6"  style="margin-bottom: 10px;margin-top:10px;"><option value="">Chọn chuyên ngành</option>';if(appDoanhNghiep.chuyenNganh.length>0){console.log("test");$.each(appDoanhNghiep.chuyenNganh,function(index,item){_strHtml+='<option value="'+item.id+'">'+item.ten_nganh+"</option>"})}_strHtml+="</select>";_strHtml+='<br/><input type="number" max="4" placeholder="Nhập năm ra trường itplus" name="nam_ra_truong" id="nam_ra_truong" class="form-control"/>';_strHtml+='<br/><input type="number" placeholder="Nhập mức lương" name="muc_luong" id="muc_luong" class="form-control"/>';_strHtml+='<br/><input type="text" placeholder="Nhập vị trí" name="vi_tri" id="vi_tri" class="form-control"/>';_strHtml+='<br><input type="button" class="btn btn-primary" id="btnAddHocVien" value=" Save " />';$("#app-modal-dialog-title").html("Thêm học viên");$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$(".search_hv").select2();searchAjax();$("#app-modal-dialog").modal("show")});function searchAjax(){$(".search_hv").select2({id:function(bond){return bond.mahv},ajax:{url:"/apps/ajax-get-ma-hoc-vien/",dataType:"json",delay:250,data:function(params){return{mahv:params.term,page:params.page}},processResults:function(data,params){params.page=params.page||1;var select2data=$.map(data.list,function(obj){obj.id=obj.id||obj.mahv;obj.text=obj.text||obj.mahv;return obj});return{results:select2data,pagination:{more:params.page*30<select2data.total_count}}},cache:true},placeholder:"Nhập mã học viên",escapeMarkup:function(markup){return markup},minimumInputLength:1,templateResult:formatItem,templateSelection:formatItemSelection});function formatItem(item){if(item.loading){return item.text}var markup="<div class='clearfix'>"+item.mahv+"</div>";return markup}function formatItemSelection(item){return item.mahv||item.text}}$("#app-modal-dialog").on("click","#btnAddHocVien",function(){var _id_nganh_hoc=$("#nganh").val();var _ma_hoc_vien=$("#mahv").val();var _nam_ra_truong_itplus=$("#nam_ra_truong").val();var _muc_luong=$("#muc_luong").val();var _vi_tri=$("#vi_tri").val();var _ho_ten=$("#ho_ten").val();if(_id_nganh_hoc==""||_nam_ra_truong_itplus==""||_muc_luong==""||_vi_tri==""||_ho_ten==""){alert("Vui lòng điền đầy đủ thông tin");return}$.post("/apps/ajax-post-hoc-vien-doanh-nghiep",{_token:$("#_token").attr("content"),mahv:_ma_hoc_vien,id_nganh_hoc:_id_nganh_hoc,nam_ra_truong_itplus:_nam_ra_truong_itplus,muc_luong:_muc_luong,vi_tri:_vi_tri,id_doanh_nghiep:appDoanhNghiep.id_doanh_nghiep,ho_ten:_ho_ten}).done(function(data,status){if(status=="success"){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã lưu thành công!</span>');setTimeout(function(){location.reload()},2e3)}}}).fail(function(err){console.log(err)}).always(function(){})});$(".listHocVien").click(function(){appDoanhNghiep.name=$(this).attr("data-name");$(".modal-dialog").addClass("modal-lg");appDoanhNghiep.id_doanh_nghiep=$(this).attr("data-id");$.get("/apps/ajax-list-hoc-vien-doanh-nghiep/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<li>"+item+"</li>"});$("#cs_msg").html('<div class="callout callout-danger"><ul class="margin-bottom:0">'+_msg_err+"</ul></div>");return}else{$("#cs_msg div").remove();appDoanhNghiep.hocVien=data.list;var _strHtml='<div class="box">';if(appDoanhNghiep.hocVien.length>0){_strHtml+='<table class="table table-bordered"><tr><th style="width: 10px">Mã học viên</th><th>Họ tên</th><th>Ngành học</th><th>Năm ra trường</th><th>Mức lương</th><th>Vị trí</th></tr>';$("#cs_msg span").remove();$.each(appDoanhNghiep.hocVien,function(index,item){_strHtml+="<tr><td>"+item.mahv+"</td><td>"+item.ho_ten+"</td><td>"+item.ten_nganh+"</td><td>"+item.nam_ra_truong_itplus+"</td><td>"+item.muc_luong+"</td><td>"+item.vi_tri+"</td></tr>"});_strHtml+="</table>"}$("#app-modal-dialog-title").html("Danh sách học viên của doanh nghiệp: "+appDoanhNghiep.name);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal({backdrop:"static",keyboard:false});$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err);alert("error")})})};appDoanhNghiep.run()}if(typeof appHuongNghiep!="undefined"){appHuongNghiep=new Object;appHuongNghiep.mahv="";appHuongNghiep.lop=[];appHuongNghiep.note=[];appHuongNghiep.comment=[];appHuongNghiep.update=[];appHuongNghiep.idhvn="";appHuongNghiep.tenhvn="";appHuongNghiep.name="";appHuongNghiep.run=function(){$(".btnComment").click(function(){appHuongNghiep.mahv=$(this).attr("data-id");appHuongNghiep.name=$(this).attr("data-name");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<textarea rows="5" placeholder="Ghi chú" name="ghi_chu" id="ghi_chu" class="form-control"></textarea>';_strHtml+='<br><input type="button" class="btn btn-primary" id="btnAddNote" value=" Save " />';$("#app-modal-dialog-title").html("Thêm ghi chú học viên: "+appHuongNghiep.name);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")});$("#app-modal-dialog").on("click","#btnAddNote",function(){var _ghi_chu=$("#ghi_chu").val();if(_ghi_chu==""){alert("Vui lòng nhập ghi chú");return}$.post("/apps/ajax-post-ghi-chu-hoc-vien",{_token:$("#_token").attr("content"),ma_hv:appHuongNghiep.mahv,noi_dung:_ghi_chu}).done(function(data,status){if(status=="success"){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã gửi thành công!</span>');setTimeout(function(){location.reload()},2e3)}}}).fail(function(err){console.log(err)}).always(function(){})});$(".btnListClass").click(function(){appHuongNghiep.name=$(this).attr("data-name");appHuongNghiep.mahv=$(this).attr("data-id");$.get("/apps/ajax-list-lop-hoc-vien/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<li>"+item+"</li>"});$("#cs_msg").html('<div class="callout callout-danger"><ul class="margin-bottom:0">'+_msg_err+"</ul></div>");return}else{$("#cs_msg div").remove();appHuongNghiep.lop=data.list;var _strHtml='<div class="box">';if(appHuongNghiep.lop.length>0){_strHtml+='<table class="table table-bordered"><tr><th>Mã lớp</th><th>Tên lớp</th><th>Ngày bắt đầu học</th><th>Ngày kết thúc</th></tr>';$("#cs_msg span").remove();$.each(appHuongNghiep.lop,function(index,item){_strHtml+="<tr><td>"+item.ma_lop+"</td><td>"+item.ten_lop+"</td><td>"+item.ngay_bat_dau+"</td><td>"+item.ngay_ket_thuc+"</td></tr>"});_strHtml+="</table>"}$("#app-modal-dialog-title").html("Danh sách lớp của học viên: "+appHuongNghiep.mahv+" - "+appHuongNghiep.name);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err)})});$(".btnListNote").click(function(){appHuongNghiep.name=$(this).attr("data-name");appHuongNghiep.mahv=$(this).attr("data-id");$.get("/apps/ajax-list-comment-hoc-vien/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<li>"+item+"</li>"});$("#cs_msg").html('<div class="callout callout-danger"><ul class="margin-bottom:0">'+_msg_err+"</ul></div>");return}else{$("#cs_msg div").remove();appHuongNghiep.note=data.list;var _strHtml='<div class="box">';if(appHuongNghiep.note.length>0){_strHtml+='<table class="table table-bordered"><tr><th>Ngày gửi</th><th>Người gửi</th><th>Nội dung</th><th>Action</th></tr>';$("#cs_msg span").remove();$.each(appHuongNghiep.note,function(index,item){_strHtml+="<tr><td>"+item.c_time+"</td><td>"+item.username+"</td><td>"+item.noi_dung+'</td><td class="text-center"><button class="btnDelete btn btn-link" data-id="'+item.id+'" ><i class="fa fa-trash text-danger"></i></button></td></tr>'});_strHtml+="</table>";_strHtml+="<script>$('.btnDelete').click(function(){if(confirm('Bạn có chắc chắn muốn xóa comment này?')){ var id = $(this).attr('data-id');$.get('/apps/ajax-delete-ghi-chu-hoc-vien/'+id) .done(function(data,status){if(status=='success'){if(data.status==0){var _msg_err = [];$.each(data.errors,function (index,item) {_msg_err += item;});alert(_msg_err);}else{alert('Xóa thành công!');location.reload();}}}) .fail(function(err){alert(err);})}});<\/script>"}$("#app-modal-dialog-title").html("Danh sách ghi chú: "+appHuongNghiep.mahv+" - "+appHuongNghiep.name);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err)})});$(".btnCommentHVN").click(function(){appHuongNghiep.idhvn=$(this).attr("data-id");appHuongNghiep.tenhvn=$(this).attr("data-name");var _strHtml='<div id="cs_msg" style="margin-bottom: 10px"></div>';_strHtml+='<textarea rows="5" placeholder="Ghi chú" name="ghi_chu" id="ghi_chu" class="form-control"></textarea>';_strHtml+='<br><input type="button" class="btn btn-primary" id="btnAddNoteHVN" value=" Save " />';$("#app-modal-dialog-title").html("Thêm ghi chú học viên: "+appHuongNghiep.tenhvn);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")});$("#app-modal-dialog").on("click","#btnAddNoteHVN",function(){var _ghi_chu=$("#ghi_chu").val();if(_ghi_chu==""){alert("Vui lòng nhập ghi chú");return}$.post("/apps/ajax-post-ghi-chu-hoc-vien-ngoai",{_token:$("#_token").attr("content"),id:appHuongNghiep.idhvn,noi_dung:_ghi_chu}).done(function(data,status){if(status=="success"){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{$("#app-modal-dialog-body").html('<span style="color:blue">Đã gửi thành công!</span>');setTimeout(function(){location.reload()},2e3)}}}).fail(function(err){console.log(err)}).always(function(){})});$(".btnListComment").click(function(){appHuongNghiep.tenhvn=$(this).attr("data-name");appHuongNghiep.idhvn=$(this).attr("data-id");$.get("/apps/ajax-list-comment-hoc-vien-ngoai/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<li>"+item+"</li>"});$("#cs_msg").html('<div class="callout callout-danger"><ul class="margin-bottom:0">'+_msg_err+"</ul></div>");return}else{$("#cs_msg div").remove();appHuongNghiep.comment=data.list;var _strHtml='<div class="box">';if(appHuongNghiep.comment.length>0){_strHtml+='<table class="table table-bordered"><tr><th>User ID</th><th>Date Time</th><th>Content</th></tr>';$("#cs_msg span").remove();$.each(appHuongNghiep.comment,function(index,item){_strHtml+="<tr><td>"+item.user_id+"</td><td>"+item.time+"</td><td>"+item.content+"</td></tr>"});_strHtml+="</table>"}$("#app-modal-dialog-title").html("List comment: "+appHuongNghiep.idhvn+" - "+appHuongNghiep.tenhvn);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err)})});$(".btnView").click(function(){appHuongNghiep.tenhvn=$(this).attr("data-name");appHuongNghiep.idhvn=$(this).attr("data-id");$.get("/apps/ajax-list-update-hoc-vien/"+$(this).attr("data-id")).done(function(data,status){console.log(data);if(status=="success"){if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<li>"+item+"</li>"});$("#cs_msg").html('<div class="callout callout-danger"><ul class="margin-bottom:0">'+_msg_err+"</ul></div>");return}else{$("#cs_msg div").remove();appHuongNghiep.update=data.list;var _strHtml='<div class="box">';if(appHuongNghiep.update.length>0){_strHtml+='<table class="table table-bordered"><tr><th>Trạng thái việc làm</th><th>Thông tin công việc</th><th>Nhu cầu tìm việc</th><th>Ghi chú</th><th>Ngày gửi</th></tr>';$("#cs_msg span").remove();$.each(appHuongNghiep.update,function(index,item){var nhucau=item.nhu_cau_tim_viec==0?"Không":"Có";var d=new Date(item.ngay_gui);var ngaygui=d.getDay()+"/"+d.getMonth()+"/"+d.getFullYear();_strHtml+="<tr><td>"+data.viec_lam[item.trang_thai_viec_lam]+"</td><td>"+item.thong_tin_cong_viec+"</td><td>"+nhucau+"</td><td>"+item.ghi_chu+"</td><td>"+ngaygui+"</td></tr>"});_strHtml+="</table>"}$("#app-modal-dialog-title").html("List update: "+appHuongNghiep.idhvn+" - "+appHuongNghiep.tenhvn);$("#app-modal-dialog-body").html("");$("#app-modal-dialog-body").append(_strHtml);$("#app-modal-dialog").modal("show")}}}).fail(function(err){console.log(err)})});$(".btnUpdateV").click(function(){appHuongNghiep.idhvn=$(this).attr("data-id");$.post("/apps/ajax-update-trang-thai-hoc-vien/"+appHuongNghiep.idhvn,{_token:$('input[name="_token"]').val(),ttvl:$("#trang_thai_viec_lam_"+appHuongNghiep.idhvn).val()}).done(function(data,status){if(status=="success"){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{alert("Cập nhật thành công!");location.reload()}}}).fail(function(err){console.log(err)}).always(function(){})});if($(".btnUpdateTrangthaiCapNhat").length>0)$(".btnUpdateTrangthaiCapNhat").click(function(){var _mhv_cap_nhat=$(this).attr("data-id");$.post("/apps/ajax-update-trangthai-capnhat/"+_mhv_cap_nhat,{_token:$('input[name="_token"]').val(),ttupdate:$("#update_trangthai_capnhat_"+_mhv_cap_nhat).val()}).done(function(data,status){if(status=="success"){console.log(data);if(data.status!=1){console.log(data.errors);var _msg_err=[];$.each(data.errors,function(index,item){_msg_err+="<br>"+item});$("#cs_msg").html('<span style="color:red">'+_msg_err+"</span>")}else{alert("Cập nhật thành công!");location.reload()}}}).fail(function(err){console.log(err)}).always(function(){})})};appHuongNghiep.run()}});